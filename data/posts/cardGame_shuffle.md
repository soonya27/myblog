# CardGame-Shuffle (Ïπ¥Îìú Í≤åÏûÑ)

## [website link](https://soonya27.github.io/cardGame-pick-flip-shuffle-/)


###

(Ïù¥ ÌîÑÎ°úÏ†ùÌä∏Îäî CardÎ•º ÏÑûÍ≥†, ÎΩëÍ≥†, ÎÇòÏó¥ÌïòÎäî Í∏∞Îä•ÏùÑ Íµ¨ÌòÑÌïú javascript Î™®Î∞îÏùº Í≤åÏûÑÏûÖÎãàÎã§.

vanilla JsÏôÄ classÎ•º Ïù¥Ïö©ÌïòÏó¨ Í∞ùÏ≤¥ ÏßÄÌñ•Ï†ÅÏù∏ ÏΩîÎìúÎ•º ÏûëÏÑ±ÌñàÏäµÎãàÎã§.)


## üåüFeatures (Ï£ºÏöî Í∏∞Îä•)

- Ïπ¥Îìú Ï¥àÍ∏∞Ìôî
- Ïπ¥Îìú ÎÇòÏó¥ (ÏùºÏûêÏ†ïÎ†¨, ÎùºÏù∏Ï†ïÎ†¨, ÏõêÌòï Ï†ïÎ†¨)
- Ïπ¥Îìú ÏÖîÌîå(Í∏∞Ï°¥ ÎÇòÏó¥ Ïú†ÏßÄ) - data shuffle
- Ïπ¥Îìú ÏÑ†ÌÉù Í∞ØÏàò ÏßÄÏ†ïÍ∞ÄÎä•
- ÏÑ†ÌÉù ÌõÑ flip Ïï†ÎãàÎ©îÏù¥ÏÖò, ÏÑ†ÌÉù ÏôÑÎ£åÌõÑ Ïπ¥Îìú Ïù¥Îèô Í∞ÄÎä•
- Ìö®Í≥ºÏùå Ï∂îÍ∞Ä

## üåüTech Stack (Í∏∞Ïà† Ïä§ÌÉù)

- **Frontend:**
  - Javascript

- **Others:**
  - Git (Version control)
  - Prettier (Code formatting and static analysis)

- **Deployment:**
  - githubpage

## üåüFeedback
I'm always looking to improve! If you have any feedback, suggestions, or bug reports, feel free to open an issue or reach out to me directly.
Thank you for visiting my portfolio website!

( Ìï≠ÏÉÅ Í∞úÏÑ†ÏùÑ ÏúÑÌïú ÌîºÎìúÎ∞±, Ï†úÏïà ÎòêÎäî Î≤ÑÍ∑∏ Ïã†Í≥†Î•º ÌôòÏòÅÌï©ÎãàÎã§! Ïñ∏Ï†úÎì†ÏßÄ Î¨∏Ï†úÎ•º Ï†úÍ∏∞ÌïòÍ±∞ÎÇò Ï†ÄÏóêÍ≤å ÏßÅÏ†ë Î¨∏ÏùòÌï¥ Ï£ºÏÑ∏Ïöî.
 Ï†ú ÌôàÌéòÏù¥ÏßÄÎ•º Î∞©Î¨∏Ìï¥ Ï£ºÏÖîÏÑú Í∞êÏÇ¨Ìï©ÎãàÎã§!)

## üåüUI
![CardGame-Shuffle](/images/posts/cardGame_shuffle-main.png)


## üåüCode block

```js
'use strict';
let con = console.log;
const coverIgmUrl = './img/cover.png';
const audioObj = {}
audioObj.clickSound = new Audio('./sounds/crash.mp3');
audioObj.spreadSound = new Audio('./sounds/spread.mp3');
audioObj.filpSound = new Audio('./sounds/sparkle.mp3'); //filpcard.mp3
audioObj.shuffleSound = new Audio('./sounds/shuffle.mp3');
audioObj.positionSound = new Audio('./sounds/shuffleSpread.mp3');


/**
 * TaroCard
 * constructor(cardObj, maxCnt)
 * @param {object[{id,imgUrl,title}...]} cardObj
 * @param {number} maxCnt : ÏÑ†ÌÉùÍ∞ÄÎä•Ìïú Ïπ¥Îìú  (ÏµúÎåÄ 5)
 * 
 * method
 * - init() : Í∏∞Î≥∏ ÏÑ∏ÌåÖ(ÏùºÏûêÎùºÏù∏Ïù¥ Í∏∞Î≥∏)
 * - spreadCurve() : Ïª§Î∏å ÎùºÏù∏ ÏÑ∏ÌåÖ
 * - shuffle() : Ïπ¥Îìú ÏÑûÍ∏∞  (line | curve Ïú†ÏßÄ)
 * 
 * property
 * - cardCount :number - Ï†ÑÏ≤¥ Ïπ¥Îìú Ïàò
 * - maxSelectCount :number - ÏÑ†ÌÉùÍ∞ÄÎä•Ìïú Ïπ¥Îìú Ïàò
 * - cardList :[{data:{id,imgUrl,title}, dom :li }...] - Ïπ¥Îìú Í∞ùÏ≤¥ Î¶¨Ïä§Ìä∏
 * - selectedList :[{data:{id,imgUrl,title}, dom :li }...] - ÏÑ†ÌÉùÎêú Ïπ¥Îìú Í∞ùÏ≤¥ Î¶¨Ïä§Ìä∏
 */
class TaroCard {
    #MAX_CARDS_IN_ONE_LINE;
    #CARD_ROW_GAP;
    #MAX_SELECET_CNT;
    #field;
    #fieldWidth;
    #fieldHeight;
    #fieldPaddingTop;
    #cardList;
    #cardListTop;
    #cardListBottom;
    #cardCount;
    #cardHeight;
    #cardWidth;
    #selectedAreaPosition;
    #animation;
    #selcetedList;
    #audioTimeout;
    #imgTimeout;
    #init;
    #lineState;
    #carpet;
    #CIRCLE_DOUBLE;
    constructor(cardObj, maxCnt) {
        this.#MAX_CARDS_IN_ONE_LINE = 12; //ÌïúÏ§Ñ ÏµúÎåÄ Ïπ¥ÎìúÍ∞ØÏàò
        this.#CARD_ROW_GAP = 20; // Ïπ¥Îìú ÏÑ∏Î°ú Í∞ÑÍ≤© px
        this.#CIRCLE_DOUBLE = 0.35;
        if (maxCnt > 5) {
            con('ÏµúÎåÄ ÏÑ†ÌÉùÍ∞ÄÎä•Ìïú Ïπ¥ÎìúÎäî 5Í∞úÏûÖÎãàÎã§.');
            this.#MAX_SELECET_CNT = 5;
        } else {
            this.#MAX_SELECET_CNT = maxCnt;
        }
        this.#field = document.querySelector('.card-wrap');
        this.#cardList = [];
        this.#selcetedList = [];
        this.#animation = {};
        this.#selectedAreaPosition = {}
        this.#cardCount = cardObj.length;
        cardObj.map(item => this.#cardList.push({ data: item }));
        //Î∞òÏùëÌòï
        window.addEventListener('resize', () => {
            // this.#init && this.reset();
            this.#init && this.#measure();
        });


    }

    /**
    * Ïπ¥Îìú Ï¥àÍ∏∞Ìôî : Í∏∞Î≥∏ ÎùºÏù∏Ï†ïÎ†¨(spread)
    */
    init() {
        this.#init = true;
        this.#lineState = 'line';

        this.#randomList();
        this.#render();
        const resetPosition = '-100%';
        //ÏúÑÏπò reset
        this.#cardList.forEach(item => {
            item.dom.style.left = resetPosition;
        });
    }

    /**
    * Ïª§Î∏å ÎùºÏù∏Ï†ïÎ†¨ 
    */
    spreadCurve() {
        this.#lineState = 'curve'
        this.#randomList();
        this.#render();
    }

    /**
       * Ïª§Î∏å ÎùºÏù∏Ï†ïÎ†¨ 
       */
    spreadCircle() {
        this.#lineState = 'circle';
        this.#randomList();
        this.#render();
    }

    /**
    * Ïπ¥ÎìúÎ•º ÏÑûÏùå -> rerenderÌïòÏßÄ ÏïäÍ≥† cardListÎ•º update Ìï® 
    * curve,line ÏÉÅÌÉúÍ∞í Ïú†ÏßÄÌïúÏ±Ñ shuffle
    */
    shuffle() {
        if (this.#lineState == 'line') {
            this.#lineState = 'shuffleLine';
        }
        //classÏÇ≠Ï†ú
        this.#field.querySelector('ul').classList.remove('clickable');
        this.#field.querySelector('ul').classList.remove('finished');

        //ÌÅ¥Î¶≠Ïó¨Î∂Ä  -> ÌÅ¥Î¶≠ÎêúÍ≤å ÏûàÍ≥† ÌÅ¥Î¶≠ Ïï†ÎãàÎ©îÏù¥ÏÖò ÏßÑÌñâÏ§ëÏùºÎïå
        if (this.selectedList.length != 0) {
            if (this.#animation.click && this.#animation.click.playState == 'running') {
                //stop -> backfilp -> imgÏöîÏÜå ÏóÜÏï†Í≥† Îã§Ïãú ÏÖîÌîåÏßÑÌñâ
                this.#stopAnimation();

                //Îã§Ïãú Îí§ÏßëÍ∏∞ ÏãúÌñâ
                this.#resetCardState();

            } else {
                this.#resetCardState();
            }
        } else {
            //spread ÎòêÎäî shuffle Ï§ëÏù¥Í±∞ÎÇò ÏïÑÎ¨¥Í≤ÉÎèÑ ÏïÑÎãåÏÉÅÌÉú
            this.#stopAnimation('spread', 'shuffle');
            if (this.#animation.spread.playState != 'finished') {
                this.#animation.spread.onfinish = () => {
                    this.#shuffleAnimation();
                }
            } else {
                this.#shuffleAnimation();
            }
        }
    }

    get cardCount() {
        return this.#cardCount;
    }

    get maxSelectCount() {
        return this.#MAX_SELECET_CNT;
    }

    get cardList() {
        return this.#cardList;
    }

    get selectedList() {
        return this.#selcetedList;
    }

    /**
    * ÌòÑÏû¨ÏÉùÏÑ±ÎèºÏûàÎäî dom ÏöîÏÜåÏùò Îç∞Ïù¥ÌÑ∞Î•º this.#cardListÏóê ÏóÖÎç∞Ïù¥Ìä∏
    */
    #updateList() {
        this.#field.querySelectorAll('li').forEach((item, idx) => {
            item.setAttribute('data-id', '');
            item.setAttribute('data-id', this.#cardList[idx].data.id);
            this.#cardList[idx].dom = item;
        });
    }

    #randomList() {
        this.#cardList.sort(() => Math.random() - 0.5);
        this.#cardListTop = Array.from(this.#cardList).slice(0, this.#MAX_CARDS_IN_ONE_LINE);
        this.#cardListBottom = Array.from(this.#cardList).slice(this.#MAX_CARDS_IN_ONE_LINE);
        this.#selcetedList = [];
    }

    #render() {
        clearTimeout(this.#imgTimeout);
        this.#field.innerHTML = '';
        const cardUl = document.createElement('ul');
        this.#field.appendChild(cardUl);
        this.#cardList.forEach((item, idx) => {
            const cardLi = document.createElement('li');
            cardLi.classList.add('unClick');
            cardLi.setAttribute('data-id', '');
            cardLi.setAttribute('data-id', item.data.id);
            cardLi.innerHTML = `<img class="front" src="${coverIgmUrl}" alt="">`;
            cardUl.appendChild(cardLi);

            //cardList domÏöîÏÜå Ï∂îÍ∞Ä
            this.#cardList[idx].dom = cardLi;

            //clickEvent
            cardLi.addEventListener('click', (e) => {
                if (!e.target.closest('ul').classList.contains('clickable')) {
                    return;
                }
                if (!e.target.closest('li').classList.contains('unClick')) {
                    return;
                }
                e.target.parentNode.classList.replace('unClick', 'clicked');
                this.#selcetedList.push(this.#cardList.find(item => item.dom == e.target.parentNode));
                playSound(audioObj.clickSound);
                this.#clickAnimation(e);
            });

            let initX, initY, firstX, firstY;

            cardLi.addEventListener('mousedown', function (e) {
                //ÏúÑÏπò Î≤óÏñ¥ÎÇòÎ©¥ return...(ÎèãÎ≥¥Í∏∞Îûë Í∞ôÏùÄ ÏõêÎ¶¨Î°ú...)
                if (e.target.localName != 'img') {
                    return;
                }
                if (e.target.closest('div').classList.contains('sparkle-img')) {
                    return;
                }
                if (!e.target.closest('ul').classList.contains('finished') ||
                    !e.target.closest('li').classList.contains('clicked')) {
                    return;
                }
                e.preventDefault();
                initX = this.offsetLeft;
                initY = this.offsetTop;
                firstX = e.pageX;
                firstY = e.pageY;
                e.target.closest('li').animate([
                    {
                        left: initX + e.pageX - firstX + 'px',
                        top: initY + e.pageY - firstY + 'px'
                    }],
                    { duration: 100, fill: "forwards" });
                this.addEventListener('mousemove', dragIt, false);

                window.addEventListener('mouseup', function () {
                    cardLi.removeEventListener('mousemove', dragIt, false);
                }, false);

            }, false);


            cardLi.addEventListener('touchstart', function (e) {
                if (e.target.localName != 'img') {
                    return;
                }
                if (e.target.closest('div').classList.contains('sparkle-img')) {
                    return;
                }
                if (!e.target.closest('ul').classList.contains('finished') ||
                    !e.target.closest('li').classList.contains('clicked')) {
                    return;
                }
                e.preventDefault();
                initX = this.offsetLeft;
                initY = this.offsetTop;
                var touch = e.touches;
                firstX = touch[0].pageX;
                firstY = touch[0].pageY;

                this.addEventListener('touchmove', swipeIt, { passive: false });

                window.addEventListener('touchend', function (e) {
                    e.preventDefault();
                    cardLi.removeEventListener('touchmove', swipeIt);
                }, { once: true });

            }, false);

            function dragIt(e) {
                this.animate([
                    {
                        left: initX + e.pageX - firstX + 'px',
                        top: initY + e.pageY - firstY + 'px'
                    }],
                    { duration: 100, fill: "forwards" });
            }

            function swipeIt(e) {
                var contact = e.touches;
                this.animate([
                    {
                        left: initX + contact[0].pageX - firstX + 'px',
                        top: initY + contact[0].pageY - firstY + 'px'
                    }],
                    { duration: 100, fill: "forwards" });
            }
        });


        //Ïπ¥ÌéòÌä∏ ÏöîÏÜå
        this.#carpet = document.createElement('div');
        this.#carpet.setAttribute('class', 'carpet-wrap');
        this.#field.appendChild(this.#carpet);

        const coverImg = new Image();
        coverImg.src = coverIgmUrl;
        coverImg.onload = () => {
            this.#measure();
            this.#lineStateAnimation();
        };
    }

    #lineStateAnimation() {
        switch (this.#lineState) {
            case 'shuffleLine':
                this.#spreadLineAnimation();
                break;
            case 'curve':
                this.#spreadCurveAnimation();
                break;
            case 'circle':
                this.#spreadCircleAnimation();
                break;
            default:
                this.#spread();
                break;
        }
    }

    #measure() {
        //imgÎÜíÏù¥Í∞í
        this.#cardHeight = this.#field.querySelector('li img').offsetHeight;
        this.#cardWidth = this.#field.querySelector('li img').offsetWidth;

        this.#fieldWidth = this.#field.clientWidth -
            (parseInt(window.getComputedStyle(this.#field).paddingLeft) +
                parseInt(window.getComputedStyle(this.#field).paddingRight));

        //liÎÜíÏù¥Í∞í ÏàòÎèôÏúºÎ°úÏßÄÏ†ï -> ÏïàÏùò imgÍ∞Ä position:absoluteÏù¥Í∏∞ÎïåÎ¨∏Ïóê
        this.#field.querySelectorAll('li').forEach((item, idx) => {
            item.style.height = this.#cardHeight + 'px';
        });

        //Ïπ¥ÎìúÌéºÏ≥êÏßÄÎäî ÏòÅÏó≠ position
        //unClick Ïπ¥Îìú Ï§ë Í∞ÄÏû• ÌïòÏúÑ ÏöîÏÜå ÏúÑÏπòÍ∞í
        const cardlowestPosition = Math.max(...this.#cardList.map(item => {
            if (!item.dom.classList.contains('unClick')) {
                return 0;
            }
            return item.dom.getBoundingClientRect().bottom;
        }));
        const borderTop = parseInt(window.getComputedStyle(document.querySelector('#canvasContainer')).borderTopWidth);
        const borderBottom = parseInt(window.getComputedStyle(document.querySelector('#canvasContainer')).borderBottomWidth);

        this.#selectedAreaPosition.top = cardlowestPosition + this.#CARD_ROW_GAP - borderTop;
        this.#fieldHeight = this.#field.clientHeight -
            (parseInt(window.getComputedStyle(this.#field).paddingTop) +
                parseInt(window.getComputedStyle(this.#field).paddingBottom));
        this.#selectedAreaPosition.height = (this.#fieldHeight - this.#selectedAreaPosition.top + this.#CARD_ROW_GAP + borderTop + borderBottom);

        this.#selectedAreaPosition.verticalCenter = this.#selectedAreaPosition.top + this.#selectedAreaPosition.height / 2 - this.#cardHeight / 2;

        this.#fieldPaddingTop = parseInt(window.getComputedStyle(this.#field).paddingTop);


        const radius = this.#fieldWidth * this.#CIRCLE_DOUBLE;
        const carpetObj = {
            line: {
                top: this.#cardHeight * 2 + this.#CARD_ROW_GAP * 2 + this.#fieldPaddingTop,
                height: this.#fieldHeight - (this.#cardHeight * 2 + this.#CARD_ROW_GAP * 2)
            },
            curve: {
                top: this.#cardHeight * 2 + this.#cardHeight / 4 + this.#CARD_ROW_GAP * 1.5 * 2 + this.#fieldPaddingTop,
                height: this.#fieldHeight - (this.#cardHeight * 2 + this.#cardHeight / 4 + this.#CARD_ROW_GAP * 1.5 * 2)
            },
            circle: {
                top: radius * 2 + this.#cardHeight + this.#fieldPaddingTop + this.#CARD_ROW_GAP,
                height: this.#fieldHeight - (radius * 2 + this.#cardHeight + this.#CARD_ROW_GAP)
            }
        }

        const carpetPositionObj = carpetObj[this.#lineState] || carpetObj['line'];
        this.#carpet.style.width = this.#fieldWidth + 'px';
        for (let key in carpetObj) {
            this.#carpet.style.top = carpetPositionObj.top + 'px';
            this.#carpet.style.height = carpetPositionObj.height + 'px';
        }
    }


    /**
     * Ïπ¥Îìú ÌéºÏ≥êÏßÄÍ∏∞ -> ( defaul line spread )
     */
    #spread() {
        this.#stopAnimation();
        this.#stopSounds();

        //spread sound
        const soundDelay = 600;
        this.#audioTimeout = setTimeout(() => {
            audioObj.spreadSound.volume = 1;
            playSound(audioObj.spreadSound);
        }, soundDelay);
        this.#audioTimeout = setTimeout(() => {
            this.#stopSounds();
            playSound(audioObj.spreadSound);
        }, soundDelay * 2);

        //Ïπ¥Îìú ÌéºÏπòÍ∏∞
        const topTimeForAnimation = 700; // 700
        this.#cardListTop.forEach((item, idx) => {
            const delay = topTimeForAnimation / this.#cardListTop.length * idx;

            item.dom.animate([
                { left: this.#calculateLeftPosition(this.#cardListTop, idx) }],
                { duration: topTimeForAnimation, fill: "forwards", delay });
        });

        this.#cardListBottom.forEach((item, idx) => {
            //top
            const topVw = this.#calculateVw(this.#cardHeight + this.#CARD_ROW_GAP);
            item.dom.style.top = topVw + 'vw';

            //left
            const delay = topTimeForAnimation + (topTimeForAnimation / this.#cardListBottom.length * idx);

            this.#animation.spread = item.dom.animate([{ left: this.#calculateLeftPosition(this.#cardListBottom, idx) },],
                { duration: topTimeForAnimation, fill: "forwards", delay });
        });

        if (!this.#animation.spread) return;
        this.#animation.spread.onfinish = () => {
            // classÏ∂îÍ∞Ä
            this.#field.querySelector('ul').classList.add('clickable');

            this.#measure();
        }
    }

    #shuffleAnimation() {
        this.#randomList();
        this.#updateList();

        //shffle -> Ïï†ÎãàÎ©îÏù¥ÏÖò Î©àÏ∂§..
        this.#stopAnimation();
        this.#stopSounds();

        //shuffleSound
        this.#audioTimeout = setTimeout(() => {
            this.#stopSounds();
            audioObj.shuffleSound.volume = 1;
            playSound(audioObj.shuffleSound);
        }, 100);

        const top = this.#calculateVw(this.#cardHeight + this.#CARD_ROW_GAP) / 2;
        const topTimeForAnimation = 1300; //1300
        this.#cardListTop.forEach((item, idx) => {
            //Í∞ÄÏö¥Îç∞ ÏúÑÏπò
            item.dom.animate([{ top: top + 'vw', left: '50%', transform: 'translateX(-50%)' },],
                { duration: topTimeForAnimation / this.#cardListTop.length, fill: "forwards" });

            //zIndex Ï¥àÍ∏∞Ìôî( Ï†ïÏ§ëÏïô flipÏù¥ÌõÑÏùò zindex ÎêòÎèåÎ¶¨Í∏∞)
            item.dom.animate({
                zIndex: 0
            },
                { duration: 100, fill: "forwards" });

            //ÏÑûÎäî motion
            const delay = topTimeForAnimation / this.#cardListTop.length * idx;
            item.dom.animate([
                { left: '50%' },
                { left: '35%' },
                { left: '50%' }
            ],
                { duration: topTimeForAnimation, delay: delay, fill: "forwards" });
            item.dom.animate([
                { left: '50%', zIndex: 0 },
                { left: '35%', zIndex: 0 },
                { left: '50%', zIndex: this.#cardListTop.length + idx }
            ],
                { duration: topTimeForAnimation, delay: delay, fill: "backwards" });
        });

        this.#cardListBottom.forEach((item, idx) => {
            //Í∞ÄÏö¥Îç∞ ÏúÑÏπò
            item.dom.animate([{ top: top + 'vw', left: '50%', transform: 'translateX(-50%)' },],
                { duration: topTimeForAnimation / this.#cardListBottom.length, fill: "forwards" });

            //zIndex Ï¥àÍ∏∞Ìôî( Ï†ïÏ§ëÏïô flipÏù¥ÌõÑÏùò zindex ÎêòÎèåÎ¶¨Í∏∞)
            item.dom.animate({
                zIndex: 0
            },
                { duration: 100, fill: "forwards" });

            //ÏÑûÎäî motion
            const delay = topTimeForAnimation / this.#cardListBottom.length * idx;
            this.#animation.shuffle = item.dom.animate([
                { left: '50%' },
                { left: '65%' },
                { left: '50%' }
            ],
                { duration: topTimeForAnimation, delay: delay, fill: "forwards" });
            this.#animation.shuffle = item.dom.animate([
                { left: '50%', zIndex: 0 },
                { left: '65%', zIndex: 0 },
                { left: '50%', zIndex: this.#cardListBottom.length + idx }
            ],
                { duration: topTimeForAnimation, delay: delay, fill: "backwards" });
        });


        //Ïπ¥Îìú ÌéºÏπòÍ∏∞
        this.#animation.shuffle.onfinish = () => {
            this.#lineStateAnimation();
        }
    }

    #spreadLineAnimation() {
        //ÏúÑÏπò Î≥ÄÍ≤Ω(0)
        this.#cardList.forEach((item, idx) => {
            // item.dom.style.zIndex = 0;
            item.dom.animate([{ top: 0, left: 0, transform: 'translateX(0)' }],
                { duration: 300, fill: 'forwards' })
        });
        //spread sound
        this.#stopSounds();
        this.#audioTimeout = setTimeout(function () {
            audioObj.spreadSound.volume = 0.6;
            playSound(audioObj.spreadSound);
        }, 300);
        this.#audioTimeout = setTimeout(function () {
            playSound(audioObj.spreadSound);
        }, 1300);

        const topTimeForAnimation = 500; //500
        let leftPosition = 0;
        let topDelay = 0;
        this.#cardListTop.forEach((item, idx) => {

            const delay = topTimeForAnimation / this.#cardListTop.length * idx;
            leftPosition = this.#calculateLeftPosition(this.#cardListTop, idx);
            topDelay = topTimeForAnimation / this.#cardListTop.length * (idx - 2);

            item.dom.animate([
                { left: this.#calculateLeftPosition(this.#cardListTop, idx) }],
                { duration: topTimeForAnimation, fill: "forwards", delay });
        });

        this.#cardListBottom.forEach((item, idx) => {
            //top
            const topVw = this.#calculateVw(this.#cardHeight + this.#CARD_ROW_GAP) + 'vw';
            const lastSpreadDelay = 400;
            //ÏúóÏ§ÑÍ≥º Ìï®Íªò Ïù¥Îèô
            item.dom.animate([
                { left: 0, top: 0 }, { left: leftPosition, top: 0 },],
                { duration: topTimeForAnimation, fill: "forwards", delay: topDelay });
            //ÏïÑÎûòÏ§ÑÎ°ú Ïù¥Îèô
            item.dom.animate([
                { left: leftPosition, top: 0 }, { left: 0, top: topVw },],
                { duration: lastSpreadDelay, fill: "forwards", delay: topDelay + topTimeForAnimation });
            //ÌéºÏ≥êÏßÄÍ∏∞
            this.#animation.shuffleSpread = item.dom.animate([{ top: topVw, left: this.#calculateLeftPosition(this.#cardListBottom, idx) },],
                { duration: topTimeForAnimation, fill: "forwards", delay: topTimeForAnimation + topDelay + lastSpreadDelay });
        });

        if (!this.#animation.shuffleSpread) return;
        this.#animation.shuffleSpread.onfinish = () => {
            //ÌéºÏ≥êÏßÑÌõÑ ÌÅ¥Î¶≠Í∞ÄÎä•(class Ï∂îÍ∞Ä)
            this.#field.querySelector('ul').classList.add('clickable');

            this.#measure();
        }
    }

    #spreadCurveAnimation() {
        this.#stopAnimation();
        const topLinePosition = this.#cardHeight / 4;
        this.#cardList.forEach((item, idx) => {
            item.dom.animate([{ top: this.#calculateVw(topLinePosition) + 'vw', left: 0, transform: 'translateX(0)' }],
                { duration: 300, fill: 'forwards' })
        });

        //spread sound
        this.#stopSounds();
        this.#audioTimeout = setTimeout(function () {
            audioObj.spreadSound.volume = 0.6;
            playSound(audioObj.spreadSound);
        }, 300);
        this.#audioTimeout = setTimeout(function () {
            playSound(audioObj.spreadSound);
        }, 1300);

        const topTimeForAnimation = 500; //500
        let topPostion = 0;
        let topAnimation = [];

        this.#cardListTop.forEach((item, idx) => {
            topPostion = this.#calculateTopPosition(this.#cardListTop, idx, topLinePosition) + 'px';
            topAnimation.push({ top: topPostion, left: this.#calculateLeftPosition(this.#cardListTop, idx) });
            item.dom.animate(topAnimation,
                { duration: topTimeForAnimation, fill: "forwards", delay: 300 });
        });
        let bottomAnimation = [];
        this.#cardListBottom.forEach((item, idx) => {
            //top
            const topVw = this.#cardHeight + this.#CARD_ROW_GAP * 1.5; //topÏúÑÏπò
            const lastSpreadDelay = 400;
            //ÏúóÏ§ÑÍ≥º Ìï®Íªò Ïù¥Îèô
            item.dom.animate(topAnimation,
                { duration: topTimeForAnimation, fill: "forwards", delay: 300 });
            topPostion = this.#calculateVw(this.#calculateTopPosition(this.#cardListBottom, idx, topLinePosition)) +
                this.#calculateVw(topVw) + 'vw';
            //ÏïÑÎûòÏ§ÑÎ°ú Ïù¥Îèô
            item.dom.animate([
                { left: 0, top: this.#calculateVw(topLinePosition + topVw) + 'vw' },],
                { duration: lastSpreadDelay, fill: "forwards", delay: topTimeForAnimation + 300 });
            //ÌéºÏ≥êÏßÄÍ∏∞
            bottomAnimation.push({ top: topPostion, left: this.#calculateLeftPosition(this.#cardListBottom, idx) });
            this.#animation.spread = item.dom.animate(bottomAnimation,
                { duration: topTimeForAnimation, fill: "forwards", delay: topTimeForAnimation + lastSpreadDelay + 300 });
        });

        if (!this.#animation.spread) return;
        this.#animation.spread.onfinish = () => {
            //ÌéºÏ≥êÏßÑÌõÑ ÌÅ¥Î¶≠Í∞ÄÎä•(class Ï∂îÍ∞Ä)
            this.#field.querySelector('ul').classList.add('clickable');

            this.#measure();
        }
    }



    #spreadCircleAnimation() {
        this.#stopAnimation();

        //spread sound
        this.#stopSounds();

        const radius = this.#fieldWidth * this.#CIRCLE_DOUBLE;
        let theta = [];
        let frags = 360 / this.#cardCount;
        for (let i = 0; i <= this.#cardCount; i++) {
            theta.push((frags / 195) * i * Math.PI);
        }
        let circleArray = [];
        for (let i = 0; i < this.#cardCount; i++) {
            circleArray.push({
                posx: Math.round(radius * (Math.cos(theta[i]))) + 'px',
                posy: Math.round(radius * (Math.sin(theta[i]))) + 'px'
            });
            // }
        }
        const timeForAnimation = 700; //900

        let topList = [];
        this.#cardList.forEach((item, idx) => {

            //ÏãúÏûë ÏúÑÏπò
            item.dom.animate([{
                top: (radius / 2 + (this.#cardHeight - this.#cardWidth) + this.#fieldPaddingTop + parseInt(circleArray[0].posy)) + 'px',
                left: ((this.#fieldWidth / 2 - this.#cardWidth / 2) - parseInt(circleArray[0].posx)) + 'px',
                transform: 'translateX(0)'
            },],
                { duration: timeForAnimation, fill: "forwards" });

            const topPostion = (radius / 2 + (this.#cardHeight - this.#cardWidth) + this.#fieldPaddingTop + parseInt(circleArray[idx].posy)) + 'px';
            const leftPositon = ((this.#fieldWidth / 2 - this.#cardWidth / 2) - parseInt(circleArray[idx].posx)) + 'px';
            topList.push({ top: topPostion, left: leftPositon });
            const delay = timeForAnimation / this.#cardList.length * idx;
            this.#animation.spread = item.dom.animate(topList,
                { duration: timeForAnimation, fill: "forwards", delay: delay + timeForAnimation });
        });

        if (!this.#animation.spread) return;
        this.#animation.spread.onfinish = () => {
            //ÌéºÏ≥êÏßÑÌõÑ ÌÅ¥Î¶≠Í∞ÄÎä•(class Ï∂îÍ∞Ä)
            this.#field.querySelector('ul').classList.add('clickable');

            this.#measure();
        }
    }


    #clickAnimation(e) {
        const target = e.target.parentNode; //li

        //ÏÑúÎ≤ÑÏù¥ÎØ∏ÏßÄ ÏûÑÏãú------------ Ïù¥ÎØ∏ÏßÄ Î°úÎî©Ï∂îÍ∞Ä ....
        const img = new Image();
        img.src = './img/cover.png';
        img.onload = () => {

            const backImg = document.createElement('img');
            const imgUrl = this.#cardList.find(item => item.data.id == target.getAttribute('data-id')).data.imgUrl;
            backImg.classList.add('back');
            backImg.setAttribute('src', imgUrl);

            //ÎΩëÎäî motion
            const clickTimeForAnimation = 600; //600
            const clickDelayForAnimation = 300; //300
            this.#animation.click = e.target.parentNode.animate([
                { transform: 'translateY(-35%)' },
            ],
                { duration: clickTimeForAnimation, fill: "forwards" });
            this.#animation.click = e.target.parentNode.animate([
                { opacity: 0 },
            ],
                { duration: clickTimeForAnimation, delay: clickDelayForAnimation, fill: "forwards" });

            //ÎΩëÌûàÎäîÎèôÏïàÏùÄ Îã§Î•∏Ïπ¥Îìú pickÎßâÍ∏∞
            e.target.closest('ul').classList.remove('clickable');

            //Ï†ïÏ§ëÏïô ÏúÑÏπò
            const flipTimeForAnimation = 1500; //1200
            this.#animation.click = target.animate([
                { top: '50%', left: '50%', transform: 'translate(-50%,-50%)', opacity: 0 },
                { top: '50%', left: '50%', transform: 'translate(-50%,-50%) scale(2)', opacity: 0 },
                { top: '50%', left: '50%', transform: 'translate(-50%,-50%) scale(2)', opacity: 1, zIndex: 9999 },
            ],
                { duration: flipTimeForAnimation, delay: clickTimeForAnimation + clickDelayForAnimation, fill: "forwards" });
            //filpSound
            //                     Ï†ïÏ§ëÏïôÏóêÏÑú flip Ïï†ÎãàÎ©îÏù¥ÏÖòÏùò delay                +  flip Ïï†ÎãàÎ©îÏù¥ÏÖò durationÏùò 2Î≤àÏß∏ Îã®Í≥ÑÏóêÏÑú soundÏãúÏûë
            const soundDelay = (clickTimeForAnimation + clickDelayForAnimation) + flipTimeForAnimation / 3 * 2;

            this.#audioTimeout = setTimeout(() => {
                playSound(audioObj.filpSound);
            }, soundDelay);
            this.#imgTimeout = setTimeout(() => {
                //sparkle ÏöîÏÜå Ï∂îÍ∞Ä
                const sparkleDiv = document.createElement('div');
                sparkleDiv.classList.add('sparkle-img');
                sparkleDiv.innerHTML = `<img src='./img/sparkle_img_twinkl.svg'>`;
                sparkleDiv.style.width = e.target.clientWidth * 5 + 'px';
                this.#field.appendChild(sparkleDiv);

                const sparkleAnimation = sparkleDiv.animate([
                    { opacity: 0 },
                    { opacity: 1 },
                    { opacity: 1 },
                    { opacity: 0 },
                ],
                    { duration: soundDelay + 200, fill: "backwards" });
                sparkleAnimation.onfinish = () => {
                    sparkleDiv.remove();
                }
            }, soundDelay);


            //back Îí∑Î©¥Ïπ¥Îìú ÏöîÏÜå Ï∂îÍ∞Ä
            this.#animation.click.onfinish = () => {
                backImg.style.transform = 'rotateY(180deg)';
                target.appendChild(backImg);

                //flip Îí§ÏßëÍ∏∞
                const flipTimeForAnimation = 600; //600
                this.#animation.click = target.querySelector('img.front').animate({
                    transform: 'rotateY( 180deg )',
                },
                    { duration: flipTimeForAnimation, fill: "forwards" });
                this.#animation.click = backImg.animate({
                    transform: 'rotateY( 0deg )',
                },
                    { duration: flipTimeForAnimation, fill: "forwards" });

                //ÌïòÎã®ÏòÅÏó≠ Ïπ¥Îìú Ï†ïÎ†¨
                const selectedCardPositionList = [
                    [{ top: this.#selectedAreaPosition.verticalCenter, left: '50%' }],
                    [{ top: this.#selectedAreaPosition.verticalCenter, left: '40%' }, { top: this.#selectedAreaPosition.verticalCenter, left: '60%' }],
                    [{ top: this.#selectedAreaPosition.verticalCenter, left: '30%' }, { top: this.#selectedAreaPosition.verticalCenter, left: '50%' }, { top: this.#selectedAreaPosition.verticalCenter, left: '70%' }],
                    [{ top: this.#selectedAreaPosition.verticalCenter, left: '20%' }, { top: this.#selectedAreaPosition.verticalCenter, left: '40%' }, { top: this.#selectedAreaPosition.verticalCenter, left: '60%' }, { top: this.#selectedAreaPosition.verticalCenter, left: '80%' }],
                    [{ top: this.#selectedAreaPosition.verticalCenter, left: '10%' }, { top: this.#selectedAreaPosition.verticalCenter, left: '30%' }, { top: this.#selectedAreaPosition.verticalCenter, left: '50%' }, { top: this.#selectedAreaPosition.verticalCenter, left: '70%' }, { top: this.#selectedAreaPosition.verticalCenter, left: '90%' }],
                ];
                const position = selectedCardPositionList[this.selectedList.length - 1][selectedCardPositionList[this.selectedList.length - 1].length - 1];


                if (this.selectedList.length > 1) {
                    const length = this.selectedList.length;
                    //Ïù¥ÎØ∏ ÎÇ¥Î†§ÏßÑ Ïπ¥Îìú ÏòÆÍ∏∞Í∏∞
                    this.#selcetedList.some((item, idx) => {
                        const position = selectedCardPositionList[length - 1][idx];
                        item.dom.animate([
                            {
                                // top: position.top + 'px',
                                left: position.left,
                                transform: 'translate(-50%, -50%)',
                                zIndex: 1
                            },
                        ],
                            { duration: flipTimeForAnimation, delay: flipTimeForAnimation * 2, fill: "forwards" });
                        //Î∞©Í∏à ÏÑ†ÌÉùÎêúÍ≤É Ï†úÏô∏
                        return idx + 1 == length - 1;
                    })
                }
                this.#animation.click = target.animate([
                    {
                        top: (position.top / this.#fieldHeight * 100) + '%',
                        left: position.left,
                        transform: 'translate(-50%, -50%)',
                        zIndex: 1
                    },
                ],
                    { duration: flipTimeForAnimation, delay: flipTimeForAnimation * 2, fill: "forwards" });
                //positionSound
                this.#audioTimeout = setTimeout(() => {
                    this.#stopSounds();
                    audioObj.positionSound.volume = 0.6;
                    playSound(audioObj.positionSound);
                }, flipTimeForAnimation * 2 + flipTimeForAnimation - 200);


                this.#animation.click.onfinish = () => {
                    //Î™®Îëê ÏÑ†ÌÉùÎêêÏúºÎ©¥ clickÎßâÍ∏∞
                    if (this.selectedList.length == this.#MAX_SELECET_CNT) {
                        e.target.closest('ul').classList.add('finished');
                        return;
                    }
                    e.target.closest('ul').classList.add('clickable');
                }
            }
        };
    }

    /**
    * Îí§ÏßëÏñ¥ÏßÑ Ïπ¥Îìú reset
    */
    #resetCardState() {
        this.selectedList.forEach((item, idx) => {
            clearTimeout(this.#imgTimeout);
            if (this.#field.querySelector('.sparkle-img')) {
                this.#field.querySelector('.sparkle-img').remove();
            }
            if (item.dom.querySelector('img.back') == null) {
                //style ÎêòÎèåÎ¶¨Í∏∞
                item.dom.animate({
                    opacity: 1
                },
                    { duration: 100, fill: "forwards" });
                item.dom.classList.replace('clicked', 'unClick');
                return;
            }

            //Î∞òÎåÄÎ°ú Îí§ÏßëÍ∏∞  front->Ïïû back->Îí§
            const flipBackTimeForAnimation = 600; //600
            const delay = flipBackTimeForAnimation / this.selectedList.length * idx
            this.#animation.flipBack = item.dom.querySelector('img.front').animate({
                transform: 'rotateY(0deg)',
            },
                { duration: flipBackTimeForAnimation, delay: delay, fill: "both" });

            this.#animation.flipBack = item.dom.querySelector('img.back').animate({
                transform: 'rotateY( 180deg )',
            },
                { duration: flipBackTimeForAnimation, delay: delay, fill: "both" });

            item.dom.classList.replace('clicked', 'unClick');

        });
        if (this.#animation.flipBack && this.#animation.flipBack.playState == 'running') {
            this.#animation.flipBack.onfinish = () => {
                this.#field.querySelectorAll('li img.back').forEach(item => {
                    item.remove();
                });
                this.#shuffleAnimation();
            }
        } else {
            this.#shuffleAnimation();
        }
    }

    #calculateVw(px) {
        return ((px) / window.innerWidth * 100);
    }

    #calculatePercentage(num) {
        return ((num) / this.#fieldWidth * 100) + '%';
    }

    /**
     * spread, curveÏãú Ïπ¥Îìú left position
     * @param {*} cardList 
     * @param {*} idx 
     * @returns {string}  px
     */
    #calculateLeftPosition(cardList, idx) {
        let leftPx = ((this.#fieldWidth - this.#cardWidth) / (cardList.length - 1));
        return this.#calculatePercentage(Math.ceil(leftPx * idx));
    }

    /**
    * spreadCurveAnimationÏãú Ïπ¥Îìú top position
    * @param {*} cardList 
    * @param {*} idx 
    * @param {*} startTop ÏãúÏûëtopÍ∞í
    * @returns {string} 
    */
    #calculateTopPosition(cardList, idx, startTop) {
        let half = cardList.length / 2
        let firstHalf = Math.ceil(half) - 1;
        let lastHalf = Math.floor(half) - 1;
        const decrease = startTop - (startTop / firstHalf * idx); // 15 7.5 0
        const increase = (startTop / lastHalf * (idx - lastHalf - 1)); //0  7.5 15
        if (idx < half) {
            return decrease;
        } else if ((firstHalf == lastHalf) && (idx == Math.floor(half))) {
            return 0;
        } else {
            return increase;
        }
    }

    #stopAnimation(...except) {
        for (let key in this.#animation) {
            if (except.some(item => item == key)) {
                continue;
            }
            if (this.#animation[key]?.playState == 'running') {
                this.#animation[key].pause();
            }
        }
    }

    #stopSounds() {
        for (let key in audioObj) {
            stopSound(audioObj[key]);
            //setTimeoutÍ±∏Ïñ¥Îëî audio clear
            clearTimeout(this.#audioTimeout);
        }
    }

    #checkRunningAnimation() {
        const result = [];
        for (const key in this.#animation) {
            if (this.#animation[key].playState == 'finished') {
                result.push({ name: key, animation: this.#animation[key] });
            }
        }
        return result;
    }

}

function playSound(sound) {
    sound.currentTime = 0;
    sound.play();
}
function stopSound(sound) {
    sound.pause();
}



```